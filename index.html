<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VS Code Style Live Editor dengan Format</title>
<style>
  * { box-sizing: border-box; }
  body, html {
    margin: 0; padding: 0; height: 100vh;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #1e1e1e;
    color: #ddd;
    display: flex;
  }
  #sidebar {
    width: 60px;
    background-color: #252526;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px 0;
    border-right: 1px solid #333;
  }
  #sidebar button {
    background: none;
    border: none;
    color: #ccc;
    font-size: 20px;
    padding: 12px 0;
    width: 100%;
    cursor: pointer;
    border-left: 4px solid transparent;
    transition: all 0.3s ease;
  }
  #sidebar button:hover {
    background-color: #333;
    color: #fff;
  }
  #sidebar button.active {
    border-left: 4px solid #007acc;
    color: #fff;
    background-color: #333;
  }
  #main {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  #toolbar {
    background: #1e1e1e;
    border-bottom: 1px solid #333;
    padding: 5px 10px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  #toolbar button {
    background: #007acc;
    border: none;
    color: white;
    padding: 6px 12px;
    border-radius: 3px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s ease;
  }
  #toolbar button:hover {
    background: #005f9e;
  }
  #editor-container {
    height: 55vh;
    background: #1e1e1e;
  }
  .CodeMirror, .CodeMirror-scroll {
    height: 100% !important;
    width: 100% !important;
  }
  .CodeMirror {
    color: #d4d4d4;
    background: #1e1e1e !important;
  }
  .CodeMirror-cursor {
    border-left: 2px solid #aeafad !important;
  }
  .CodeMirror-gutters {
    background: #1e1e1e !important;
    border-right: none !important;
  }
  #preview-container {
    height: 40vh;
    border-top: 1px solid #333;
    position: relative;
  }
  #preview {
    width: 100%;
    height: 100%;
    border: none;
    background: white;
  }
  /* iPhone preview frame */
  #iphone-frame {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 320px;
    height: 568px;
    border: 12px solid black;
    border-radius: 40px;
    box-shadow: 0 0 15px rgba(0,0,0,0.7);
    overflow: hidden;
    display: none;
  }
  #iphone-preview {
    width: 100%;
    height: 100%;
    border: none;
  }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/dracula.min.css" />
</head>
<body>

<div id="sidebar">
  <button id="btn-html" class="active" title="HTML">&lt;/&gt;</button>
  <button id="btn-css" title="CSS">ðŸŽ¨</button>
  <button id="btn-js" title="JavaScript">JS</button>
</div>

<div id="main">
  <div id="toolbar">
    <button id="formatBtn" title="Format Kode">Format Kode</button>
    <button id="resetBtn" title="Reset Kode">Reset</button>
    <button id="togglePreview" title="Toggle Preview Mode">Switch to Mobile Preview</button>
  </div>
  <div id="editor-container">
    <textarea id="code-editor"></textarea>
  </div>
  <div id="preview-container">
    <iframe id="preview"></iframe>
    <div id="iphone-frame">
      <iframe id="iphone-preview"></iframe>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/css/css.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-beautify@1.14.0/js/lib/beautify.js"></script>

<script>
  const btnHtml = document.getElementById('btn-html');
  const btnCss = document.getElementById('btn-css');
  const btnJs = document.getElementById('btn-js');
  const preview = document.getElementById('preview');
  const iphoneFrame = document.getElementById('iphone-frame');
  const iphonePreview = document.getElementById('iphone-preview');
  const formatBtn = document.getElementById('formatBtn');
  const resetBtn = document.getElementById('resetBtn');
  const togglePreviewBtn = document.getElementById('togglePreview');

  // Default kode (sesuai permintaanmu)
  const defaultCode = {
    html: `<h1>Hello dari HTML!</h1>\n<p>Ini editor ala VS Code.</p>`,
    css: `body { font-family: Arial, sans-serif; background: #1e1e1e; color: #ddd; padding: 20px; }`,
    js: `console.log('JS aktif!');`
  };

  // Kode yang aktif di editor, mulai dari default
  let codeData = {...defaultCode};

  // Mapping mode untuk CodeMirror
  const modeMap = { html: 'xml', css: 'css', js: 'javascript' };

  // Bahasa aktif sekarang
  let currentLanguage = 'html';

  // Inisialisasi CodeMirror
  const textarea = document.getElementById('code-editor');
  let editor = CodeMirror.fromTextArea(textarea, {
    mode: modeMap[currentLanguage],
    theme: 'dracula',
    lineNumbers: true,
    electricChars: true,
    autoCloseBrackets: true,
    matchBrackets: true,
    indentUnit: 2,
    tabSize: 2,
    indentWithTabs: false
  });

  editor.setValue(codeData[currentLanguage]);

  function switchLanguage(lang) {
    // Simpan dulu kode yang sedang diedit
    codeData[currentLanguage] = editor.getValue();
    currentLanguage = lang;

    // Update tombol active
    [btnHtml, btnCss, btnJs].forEach(btn => btn.classList.remove('active'));
    if(lang === 'html') btnHtml.classList.add('active');
    else if(lang === 'css') btnCss.classList.add('active');
    else btnJs.classList.add('active');

    // Ganti mode editor dan tampilkan kode yang tersimpan
    editor.setOption('mode', modeMap[lang]);
    editor.setValue(codeData[lang]);
    editor.focus();
  }

  btnHtml.addEventListener('click', () => switchLanguage('html'));
  btnCss.addEventListener('click', () => switchLanguage('css'));
  btnJs.addEventListener('click', () => switchLanguage('js'));

  function updatePreview() {
    const source = `
      <!DOCTYPE html>
      <html lang="id">
      <head><style>${codeData.css}</style></head>
      <body>
        ${codeData.html}
        <script>${codeData.js}<\/script>
      </body>
      </html>
    `;
    preview.srcdoc = source;
    iphonePreview.srcdoc = source;
  }

  editor.on('change', () => {
    codeData[currentLanguage] = editor.getValue();
    updatePreview();
  });

  formatBtn.addEventListener('click', () => {
    const code = editor.getValue();
    let formatted = code;

    if(currentLanguage === 'js') {
      formatted = js_beautify.js(code, { indent_size: 2 });
    } else if(currentLanguage === 'html') {
      formatted = js_beautify.html(code, { indent_size: 2 });
    } else if(currentLanguage === 'css') {
      formatted = js_beautify.css(code, { indent_size: 2 });
    }

    editor.setValue(formatted);
  });

  resetBtn.addEventListener('click', () => {
    if(confirm('Reset kode ke default? Semua perubahan akan hilang.')) {
      codeData = {...defaultCode};
      editor.setValue(codeData[currentLanguage]);
      updatePreview();
    }
  });

  let previewMode = 'desktop';
  togglePreviewBtn.addEventListener('click', () => {
    if(previewMode === 'desktop') {
      preview.style.display = 'none';
      iphoneFrame.style.display = 'block';
      togglePreviewBtn.textContent = 'Switch to Desktop Preview';
      previewMode = 'mobile';
    } else {
      preview.style.display = 'block';
      iphoneFrame.style.display = 'none';
      togglePreviewBtn.textContent = 'Switch to Mobile Preview';
      previewMode = 'desktop';
    }
  });

  // Init preview awal
  updatePreview();
</script>

</body>
</html>
