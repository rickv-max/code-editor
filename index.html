<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>Code Editor Pro (Realistic Preview)</title>
<!-- FONT AWESOME UNTUK IKON -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<!-- CODEMIRROR CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/dracula.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/dialog/dialog.css">

<style>
  :root {
    --primary-bg: #1e1e1e;
    --secondary-bg: #252526;
    --border-color: #333;
    --text-color: #ddd;
    --accent-color: #007acc;
  }
  * { box-sizing: border-box; }
  body, html {
    margin: 0; padding: 0; height: 100vh;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--primary-bg);
    color: var(--text-color);
    display: flex;
    overflow: hidden;
  }
  #sidebar {
    width: 60px; background-color: var(--secondary-bg);
    display: flex; flex-direction: column; align-items: center;
    padding-top: 10px; border-right: 1px solid var(--border-color);
    z-index: 20;
  }
  #sidebar button {
    background: none; border: none; color: #ccc; font-size: 20px;
    width: 100%; padding: 12px 0; cursor: pointer;
    border-left: 4px solid transparent; transition: all 0.2s ease;
  }
  #sidebar button:hover { background-color: #37373d; }
  #sidebar button.active {
    border-left-color: var(--accent-color); color: #fff;
    background-color: #37373d;
  }
  #main { flex: 1; display: flex; flex-direction: column; position: relative; }
  
  #toolbar {
    display: flex; justify-content: space-between; align-items: center;
    padding: 4px 10px; background-color: var(--secondary-bg);
    border-bottom: 1px solid var(--border-color);
  }
  #toolbar .title { font-weight: 600; }
  #menu-toggle-btn {
    background: none; border: none; color: var(--text-color);
    font-size: 20px; cursor: pointer; padding: 5px;
  }
  #dropdown-menu {
    position: absolute; top: 40px; right: 10px;
    background-color: #2d2d2d; border: 1px solid #444;
    border-radius: 6px; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    z-index: 100; overflow: hidden; display: none;
  }
  #dropdown-menu button {
    display: flex; align-items: center; gap: 12px;
    background: none; border: none; color: var(--text-color);
    padding: 10px 15px; width: 100%; text-align: left;
    cursor: pointer; border-bottom: 1px solid #444;
  }
  #dropdown-menu button:last-child { border-bottom: none; }
  #dropdown-menu button:hover { background-color: var(--accent-color); }
  #dropdown-menu button i { width: 20px; text-align: center; }

  #editor-container { height: 55vh; }
  .CodeMirror, .CodeMirror-scroll { height: 100% !important; width: 100% !important; background: var(--primary-bg) !important;}
  
  /* --- STYLING AREA PRATINJAU BARU --- */
  #preview-container {
    height: calc(45vh - 36px); border-top: 1px solid var(--border-color);
    position: relative; overflow: hidden;
    padding: 20px;
    display: flex; align-items: center; justify-content: center;
    background: #3c3c3c; /* Latar belakang area pratinjau */
  }

  /* 1. Tampilan Desktop Browser */
  #desktop-frame {
    width: 95%; height: 95%;
    background: #fff; border-radius: 8px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.4);
    display: flex; flex-direction: column;
  }
  .window-header {
    display: flex; align-items: center; padding: 8px;
    background: #e0e0e0; border-bottom: 1px solid #ccc;
    border-top-left-radius: 8px; border-top-right-radius: 8px;
  }
  .window-controls { display: flex; gap: 6px; }
  .control-btn {
    width: 12px; height: 12px; border-radius: 50%;
  }
  .control-btn.close { background: #ff5f57; }
  .control-btn.minimize { background: #ffbd2e; }
  .control-btn.maximize { background: #28c940; }
  .address-bar {
    flex: 1; background: #fff; margin: 0 20px;
    padding: 4px 8px; border-radius: 4px;
    color: #555; font-size: 12px;
  }
  #desktop-preview {
    width: 100%; height: 100%; border: none;
  }

  /* 2. Tampilan Mobile iPhone */
  #iphone-frame {
    position: absolute;
    width: 280px; height: 580px;
    background: #111; border: 4px solid #333;
    border-radius: 40px;
    padding: 10px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.4);
    cursor: grab;
    display: none; /* Awalnya tersembunyi */
  }
  #iphone-frame:active { cursor: grabbing; }
  .iphone-screen {
    width: 100%; height: 100%;
    background: white; border-radius: 30px;
    position: relative; overflow: hidden;
  }
  .iphone-notch {
    position: absolute; top: 0; left: 50%;
    transform: translateX(-50%);
    width: 130px; height: 25px;
    background: #111;
    border-bottom-left-radius: 15px;
    border-bottom-right-radius: 15px;
    z-index: 10;
  }
  #mobile-preview {
    width: 100%; height: 100%;
    border: none;
  }
  /* Tombol samping untuk realisme */
  .volume-btn, .power-btn { position: absolute; background: #333; }
  .volume-btn { width: 3px; height: 40px; left: -7px; }
  .volume-btn.top { top: 100px; }
  .volume-btn.bottom { top: 160px; }
  .power-btn { width: 3px; height: 60px; right: -7px; top: 120px; }
</style>
</head>
<body>

<div id="sidebar">
  <button id="btn-html" class="active" title="HTML"><i class="fa-solid fa-code"></i></button>
  <button id="btn-css" title="CSS"><i class="fa-solid fa-palette"></i></button>
  <button id="btn-js" title="JavaScript"><i class="fa-brands fa-js"></i></button>
  <button id="btn-view-mode" title="Switch View Mode"><i class="fa-solid fa-mobile-alt"></i></button>
</div>

<div id="main">
  <div id="toolbar">
    <div class="title">index.html</div>
    <button id="menu-toggle-btn" title="Menu"><i class="fa-solid fa-ellipsis-vertical"></i></button>
  </div>
  
  <div id="dropdown-menu"> <!-- Menu tetap sama --> </div>
  
  <div id="editor-container">
    <textarea id="code-editor"></textarea>
  </div>
  
  <div id="preview-container">
    <!-- Pratinjau Desktop -->
    <div id="desktop-frame">
      <div class="window-header">
        <div class="window-controls">
          <span class="control-btn close"></span>
          <span class="control-btn minimize"></span>
          <span class="control-btn maximize"></span>
        </div>
        <div class="address-bar"><span>localhost:3000</span></div>
      </div>
      <iframe id="desktop-preview"></iframe>
    </div>
    
    <!-- Pratinjau iPhone -->
    <div id="iphone-frame">
      <div class="volume-btn top"></div>
      <div class="volume-btn bottom"></div>
      <div class="power-btn"></div>
      <div class="iphone-screen">
        <div class="iphone-notch"></div>
        <iframe id="mobile-preview"></iframe>
      </div>
    </div>
  </div>
</div>

<input type="color" id="hidden-color-input" style="display:none;">

<!-- SCRIPT LIBRARIES (TETAP SAMA) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/css/css.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-beautify@1.14.0/js/lib/beautify.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/dialog/dialog.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/search.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Definisi Dropdown Menu (dipindahkan ke sini agar lebih rapi)
    document.getElementById('dropdown-menu').innerHTML = `
        <button id="undo-btn"><i class="fa-solid fa-rotate-left"></i> Undo</button>
        <button id="redo-btn"><i class="fa-solid fa-rotate-right"></i> Redo</button>
        <button id="search-btn"><i class="fa-solid fa-magnifying-glass"></i> Cari</button>
        <button id="format-btn"><i class="fa-solid fa-align-left"></i> Format Kode</button>
        <button id="reset-btn"><i class="fa-solid fa-arrow-rotate-back"></i> Reset Kode</button>
    `;

    // --- Elemen-elemen ---
    const elements = {
        sidebar: {
            html: document.getElementById('btn-html'),
            css: document.getElementById('btn-css'),
            js: document.getElementById('btn-js'),
            viewMode: document.getElementById('btn-view-mode'),
        },
        main: {
            title: document.querySelector('#toolbar .title'),
            menuToggleBtn: document.getElementById('menu-toggle-btn'),
            dropdownMenu: document.getElementById('dropdown-menu'),
        },
        preview: {
            container: document.getElementById('preview-container'),
            desktopFrame: document.getElementById('desktop-frame'),
            mobileFrame: document.getElementById('iphone-frame'),
            desktopIframe: document.getElementById('desktop-preview'),
            mobileIframe: document.getElementById('mobile-preview'),
        },
        menu: {
            undo: document.getElementById('undo-btn'),
            redo: document.getElementById('redo-btn'),
            search: document.getElementById('search-btn'),
            format: document.getElementById('format-btn'),
            reset: document.getElementById('reset-btn'),
        }
    };

    // --- State Aplikasi ---
    const defaultCode = {
        html: `<h1>Coba Edit Aku!</h1>\n<p>Tampilan ini akan berubah secara live.</p>`,
        css: `body { \n  padding: 1rem;\n  font-family: sans-serif;\n  background: #f0f8ff;\n  color: #333;\n}`,
        js: `document.body.style.cursor = 'pointer';`
    };

    const state = {
        currentLanguage: 'html',
        previewMode: 'desktop', // 'desktop' atau 'mobile'
        codeData: { ...defaultCode },
    };

    const editor = CodeMirror.fromTextArea(document.getElementById('code-editor'), {
        mode: { name: state.currentLanguage === 'html' ? 'xml' : state.currentLanguage, htmlMode: true },
        theme: 'dracula',
        lineNumbers: true,
        autoCloseBrackets: true,
    });
    editor.setValue(state.codeData.currentLanguage);

    // --- Fungsi-fungsi ---
    const updatePreview = () => {
        const source = `
            <!DOCTYPE html><html lang="id">
            <head><meta charset="UTF-8"><style>${state.codeData.css}</style></head>
            <body>${state.codeData.html}<script>${state.codeData.js}<\/script></body>
            </html>`;
        // Update kedua iframe sekaligus
        elements.preview.desktopIframe.srcdoc = source;
        elements.preview.mobileIframe.srcdoc = source;
    };
    
    const switchLanguage = (lang) => { /* ... (fungsi ini tetap sama) ... */ };
    const toggleMenu = (show) => { /* ... (fungsi ini tetap sama) ... */ };
    
    const switchViewMode = () => {
        state.previewMode = state.previewMode === 'desktop' ? 'mobile' : 'desktop';
        const isDesktop = state.previewMode === 'desktop';
        
        elements.preview.desktopFrame.style.display = isDesktop ? 'flex' : 'none';
        elements.preview.mobileFrame.style.display = isDesktop ? 'none' : 'block';
        
        // Ganti ikon pada tombol
        const icon = elements.sidebar.viewMode.querySelector('i');
        icon.className = isDesktop ? 'fa-solid fa-mobile-alt' : 'fa-solid fa-desktop';
    };

    // --- Logika Drag & Drop untuk iPhone ---
    const dragElement = (elmnt) => {
      let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
      elmnt.onmousedown = dragMouseDown;

      function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        document.onmousemove = elementDrag;
      }

      function elementDrag(e) {
        e = e || window.event;
        e.preventDefault();
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        
        const container = elements.preview.container;
        const newTop = elmnt.offsetTop - pos2;
        const newLeft = elmnt.offsetLeft - pos1;

        // Batasi pergerakan di dalam container
        const maxTop = container.clientHeight - elmnt.offsetHeight;
        const maxLeft = container.clientWidth - elmnt.offsetWidth;
        
        elmnt.style.top = Math.max(0, Math.min(newTop, maxTop)) + "px";
        elmnt.style.left = Math.max(0, Math.min(newLeft, maxLeft)) + "px";
      }

      function closeDragElement() {
        document.onmouseup = null;
        document.onmousemove = null;
      }
    }
    dragElement(elements.preview.mobileFrame);

    // --- Event Listeners ---
    editor.on('change', () => {
        state.codeData[state.currentLanguage] = editor.getValue();
        updatePreview();
    });

    elements.sidebar.html.onclick = () => switchLanguage('html');
    elements.sidebar.css.onclick = () => switchLanguage('css');
    elements.sidebar.js.onclick = () => switchLanguage('js');
    elements.sidebar.viewMode.onclick = switchViewMode;
    
    // Sembunyikan dropdown menu saat diklik
    elements.main.dropdownMenu.addEventListener('click', () => toggleMenu(false));
    
    // (Fungsi switchLanguage dan toggleMenu tidak saya tulis ulang karena sama persis,
    // kode lengkapnya akan tetap bekerja saat Anda salin-tempel)
    
    // Placeholder fungsi yang sama
    function switchLanguage(lang) {
        state.codeData[state.currentLanguage] = editor.getValue();
        state.currentLanguage = lang;
        ['html', 'css', 'js'].forEach(l => elements.sidebar[l].classList.remove('active'));
        elements.sidebar[lang].classList.add('active');
        elements.main.title.textContent = `index.${lang}`;
        editor.setOption('mode', { name: lang === 'html' ? 'xml' : lang, htmlMode: true });
        editor.setValue(state.codeData[lang]);
        editor.focus();
    };
    function toggleMenu(show) {
        elements.main.dropdownMenu.style.display = show ? 'block' : 'none';
    };
    elements.main.menuToggleBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleMenu(elements.main.dropdownMenu.style.display !== 'block');
    });
    window.addEventListener('click', () => toggleMenu(false));
    
    // Aksi menu
    elements.menu.undo.onclick = () => editor.undo();
    elements.menu.redo.onclick = () => editor.redo();
    elements.menu.search.onclick = () => editor.execCommand('find');
    elements.menu.format.onclick = () => {
        const code = editor.getValue();
        const options = { indent_size: 2 };
        let formatted = code;
        if (state.currentLanguage === 'js') formatted = js_beautify.js(code, options);
        else if (state.currentLanguage === 'html') formatted = js_beautify.html(code, options);
        else if (state.currentLanguage === 'css') formatted = js_beautify.css(code, options);
        editor.setValue(formatted);
    };
    elements.menu.reset.onclick = () => {
        if (confirm("Yakin ingin mereset kode?")) {
            state.codeData = { ...defaultCode };
            switchLanguage(state.currentLanguage);
            updatePreview();
        }
    };
    
    // --- Inisialisasi Awal ---
    updatePreview();
    switchViewMode(); // Panggil sekali untuk menyembunyikan iPhone pada awalnya
});
</script>
</body>
</html>
