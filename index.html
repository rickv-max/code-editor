<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VS Code Style Live Editor - Versi Final Stabil</title>
<style>
  * { box-sizing: border-box; }
  body, html {
    margin: 0; padding: 0; height: 100vh;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #1e1e1e; color: #ddd;
    display: flex; overflow: hidden;
  }
  #sidebar {
    width: 60px; background-color: #252526; display: flex;
    flex-direction: column; align-items: center; padding: 10px 0;
    border-right: 1px solid #333;
  }
  #sidebar button {
    background: none; border: none; color: #ccc; font-size: 20px;
    padding: 12px 0; width: 100%; cursor: pointer;
    border-left: 4px solid transparent; transition: all 0.3s ease;
  }
  #sidebar button:hover { background-color: #333; color: #fff; }
  #sidebar button.active {
    border-left: 4px solid #007acc; color: #fff; background-color: #333;
  }
  #main { flex: 1; display: flex; flex-direction: column; }
  #toolbar {
    background: #1e1e1e; border-bottom: 1px solid #333;
    padding: 5px 10px; display: flex; align-items: center; gap: 8px;
  }
  #toolbar button {
    background: #007acc; border: none; color: white; padding: 6px 12px;
    border-radius: 3px; font-weight: 600; cursor: pointer;
    transition: background 0.2s ease;
  }
  #toolbar button:hover { background: #005f9e; }
  #toolbar button#saveBtn { background-color: #3ea850; }
  #toolbar button#saveBtn:hover { background-color: #2c7c3a; }

  #editor-container { height: 55vh; background: #1e1e1e; }
  .CodeMirror, .CodeMirror-scroll { height: 100% !important; width: 100% !important; }
  .CodeMirror { color: #d4d4d4; background: #1e1e1e !important; }
  .CodeMirror-cursor { border-left: 2px solid #aeafad !important; }
  .CodeMirror-gutters { background: #1e1e1e !important; border-right: none !important; }
  
  #preview-container { height: 45vh; border-top: 1px solid #333; position: relative; overflow: hidden; }
  #preview { width: 100%; height: 100%; border: none; background: white; display: block; }
  
  #iphone-frame {
    position: absolute; width: 320px; height: 95%; max-height: 568px;
    border: 12px solid black; border-radius: 40px; box-shadow: 0 0 15px rgba(0,0,0,0.7);
    overflow: hidden; user-select: none; -webkit-user-select: none;
    cursor: grab; background: black; z-index: 10; display: none;
  }
  #iphone-frame.dragging { cursor: grabbing; }
  #iphone-preview { width: 100%; height: 100%; border: none; background: white; pointer-events: none; }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/dracula.min.css" />
</head>
<body>

<div id="sidebar">
  <button id="btn-html" class="active" title="HTML">&lt;/&gt;</button>
  <button id="btn-css" title="CSS">ðŸŽ¨</button>
  <button id="btn-js" title="JavaScript">JS</button>
</div>

<div id="main">
  <div id="toolbar">
    <button id="saveBtn" title="Simpan Kode ke Memori Browser">Simpan</button>
    <button id="formatBtn" title="Format Kode">Format Kode</button>
    <button id="resetBtn" title="Reset Kode ke Default">Reset</button>
    <button id="togglePreview" title="Toggle Preview Mode">Switch to Mobile Preview</button>
  </div>
  <div id="editor-container">
    <textarea id="code-editor"></textarea>
  </div>
  <div id="preview-container">
    <iframe id="preview"></iframe>
    <div id="iphone-frame">
      <iframe id="iphone-preview"></iframe>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/css/css.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-beautify@1.14.0/js/lib/beautify.js"></script>

<script>
  const saveBtn = document.getElementById('saveBtn');
  const btnHtml = document.getElementById('btn-html');
  const btnCss = document.getElementById('btn-css');
  const btnJs = document.getElementById('btn-js');
  const preview = document.getElementById('preview');
  const iphoneFrame = document.getElementById('iphone-frame');
  const iphonePreview = document.getElementById('iphone-preview');
  const formatBtn = document.getElementById('formatBtn');
  const resetBtn = document.getElementById('resetBtn');
  const togglePreviewBtn = document.getElementById('togglePreview');

  const defaultCode = {
    html: `<h1>Hello dari HTML!</h1>\n<p>Ini editor ala VS Code.</p>`,
    css: `body {\n  font-family: Arial, sans-serif;\n  background: #f0f0f0;\n  color: #333;\n  padding: 20px;\n}`,
    js: `console.log('JS aktif!');`
  };

  let codeData = JSON.parse(localStorage.getItem('codeData')) || { ...defaultCode };
  const modeMap = { html: 'xml', css: 'css', js: 'javascript' };
  let currentLanguage = 'html';

  const textarea = document.getElementById('code-editor');
  let editor = CodeMirror.fromTextArea(textarea, {
    mode: modeMap[currentLanguage],
    theme: 'dracula',
    lineNumbers: true,
    autoCloseBrackets: true,
    matchBrackets: true,
    indentUnit: 2
  });
  editor.setValue(codeData[currentLanguage]);

  function switchLanguage(lang) {
    codeData[currentLanguage] = editor.getValue();
    currentLanguage = lang;
    [btnHtml, btnCss, btnJs].forEach(btn => btn.classList.remove('active'));
    document.getElementById(`btn-${lang}`).classList.add('active');
    editor.setOption('mode', modeMap[lang]);
    editor.setValue(codeData[lang]);
    editor.focus();
  }

  function updatePreview() {
    const source = `
      <!DOCTYPE html><html lang="id">
      <head><meta charset="UTF-8"><style>${codeData.css}</style></head>
      <body>
        ${codeData.html}
        <script>${codeData.js}<\/script>
      </body></html>`;
    preview.srcdoc = source;
    iphonePreview.srcdoc = source;
  }
  
  editor.on('change', () => {
    codeData[currentLanguage] = editor.getValue();
    updatePreview();
  });

  saveBtn.addEventListener('click', () => {
    localStorage.setItem('codeData', JSON.stringify(codeData));
    alert('Kode berhasil disimpan di browser!');
  });

  formatBtn.addEventListener('click', () => {
    let formatted;
    const code = editor.getValue();
    const options = { indent_size: 2, space_in_empty_paren: true };
    if (currentLanguage === 'js') formatted = js_beautify.js(code, options);
    else if (currentLanguage === 'html') formatted = js_beautify.html(code, options);
    else if (currentLanguage === 'css') formatted = js_beautify.css(code, options);
    if (formatted) editor.setValue(formatted);
  });

  resetBtn.addEventListener('click', () => {
    if (confirm('Reset kode ke default? Perubahan yang belum disimpan akan hilang.')) {
      localStorage.removeItem('codeData');
      codeData = { ...defaultCode };
      editor.setValue(codeData[currentLanguage]);
    }
  });

  let previewMode = 'desktop';
  togglePreviewBtn.addEventListener('click', () => {
    previewMode = (previewMode === 'desktop') ? 'mobile' : 'desktop';
    const isMobile = previewMode === 'mobile';
    preview.style.display = isMobile ? 'none' : 'block';
    iphoneFrame.style.display = isMobile ? 'block' : 'none';
    togglePreviewBtn.textContent = isMobile ? 'Switch to Desktop Preview' : 'Switch to Mobile Preview';
    if (isMobile) setInitialPosition();
  });

  let isDragging = false, offsetX, offsetY;
  
  function setInitialPosition() {
    const container = iphoneFrame.parentElement;
    if (container) {
      iphoneFrame.style.left = `${(container.clientWidth - iphoneFrame.offsetWidth) / 2}px`;
      iphoneFrame.style.top = `${(container.clientHeight - iphoneFrame.offsetHeight) / 2}px`;
    }
  }

  iphoneFrame.addEventListener('mousedown', (e) => {
    isDragging = true;
    offsetX = e.clientX - iphoneFrame.offsetLeft;
    offsetY = e.clientY - iphoneFrame.offsetTop;
    iphoneFrame.classList.add('dragging');
    e.preventDefault();
  });

  window.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    const container = iphoneFrame.parentElement;
    const newLeft = e.clientX - offsetX;
    const newTop = e.clientY - offsetY;
    const maxLeft = container.clientWidth - iphoneFrame.offsetWidth;
    const maxTop = container.clientHeight - iphoneFrame.offsetHeight;

    iphoneFrame.style.left = `${Math.max(0, Math.min(newLeft, maxLeft))}px`;
    iphoneFrame.style.top = `${Math.max(0, Math.min(newTop, maxTop))}px`;
  });

  window.addEventListener('mouseup', () => {
    isDragging = false;
    iphoneFrame.classList.remove('dragging');
  });

  updatePreview();
</script>

</body>
</html>
